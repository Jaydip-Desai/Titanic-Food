Practical-2
-----------
- Write a query to identify lock in the database and generate formatted output for better understanding.



SELECT * FROM student_master
WHERE stdid = 1
FOR UPDATE;

select sid, username from v$session;

SELECT 
    s.sid AS "Session ID",
    s.serial# AS "Serial Number",
    s.username AS "Username",
    l.type AS "Lock Type",
    l.lmode AS "Lock Mode",
    l.request AS "Request Mode",
    l.id1 AS "ID1 (Object ID)",
    l.id2 AS "ID2 (Sub-object ID)"
FROM 
    v$session s
JOIN 
    v$lock l ON s.sid = l.sid
WHERE 
    s.sid = 154;

COMMIT;  or ROLLBACK;


SET LINESIZE 200
SET PAGESIZE 50

COLUMN "Session ID"      FORMAT 99999
COLUMN "Serial Number"   FORMAT 999999
COLUMN "Username"        FORMAT A15
COLUMN "Lock Type"       FORMAT A5
COLUMN "Lock Mode"       FORMAT 999
COLUMN "Request Mode"    FORMAT 999
COLUMN "ID1 (Object ID)" FORMAT 999999999
COLUMN "ID2 (Sub-object ID)" FORMAT 999999999



LOCK TABLE student_master IN EXCLUSIVE MODE;


SELECT * FROM student_master
WHERE stdid = 1
FOR UPDATE;

select sid, username from v$session;

SELECT 
    s.sid AS "Session ID",
    s.serial# AS "Serial Number",
    s.username AS "Username",
    l.type AS "Lock Type",
    l.lmode AS "Lock Mode",
    o.object_name AS "Locked Table",
    l.id1 AS "ID1 (Object ID)",
    l.id2 AS "ID2 (Sub-object ID)"
FROM 
    v$session s
JOIN 
    v$lock l ON s.sid = l.sid
JOIN 
    dba_objects o ON l.id1 = o.object_id
WHERE 
    l.type = 'TM' and s.sid = 394;


SET LINESIZE 200
SET PAGESIZE 50

COLUMN "Session ID"        FORMAT 99999
COLUMN "Serial Number"     FORMAT 999999
COLUMN "Username"          FORMAT A12
COLUMN "Lock Type"         FORMAT A5
COLUMN "Lock Mode"         FORMAT 999
COLUMN "Locked Table"      FORMAT A20
COLUMN "ID1 (Object ID)"   FORMAT 999999999
COLUMN "ID2 (Sub-object ID)" FORMAT 999999999



COMMIT;  or ROLLBACK;







CREATE TABLE student_master (
    stdid NUMBER PRIMARY KEY,
    name  VARCHAR2(50),
    course VARCHAR2(50)
);

INSERT INTO student_master VALUES (1, 'Jaydip', 'MCA');
INSERT INTO student_master VALUES (2, 'Ravi', 'MBA');
INSERT INTO student_master VALUES (3, 'Priya', 'B.Tech');




TX: Transactional lock
Row: Row-level lock
Table: Table-level lock

0: No lock
1: Null
2: Row-S, Shared row lock
3: Row-X, Exclusive row lock
4: Share lock
5: Exclusive lock
